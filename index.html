<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Design Your Ring</title>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Outfit', sans-serif; }
  </style>
</head>
<body>
  <div id="ring-builder-root"></div>
  
  <script type="text/babel" data-presets="react">
    // ============================================
    // CONFIGURATION - UPDATE THESE VALUES
    // ============================================
    const CONFIG = {
      // Your deployed backend URL
      API_BASE_URL: 'https://ring-builder-api.onrender.com/api',
      
      // Your Shopify store domain (update this later)
      SHOPIFY_DOMAIN: 'your-store.myshopify.com',
      
      // The variant ID of your "Custom Ring" product (update this later)
      CUSTOM_RING_VARIANT_ID: '12345678901234',
      
      // Live API is now enabled
      USE_LIVE_API: true
    };
    // ============================================

    const { useState, useEffect, useCallback } = React;

    // Icons as simple SVG components
    const Icon = ({ name, size = 24 }) => {
      const icons = {
        upload: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>,
        diamond: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M6 3h12l4 6-10 13L2 9z"/><path d="M2 9h20"/><path d="M12 22L6 9"/><path d="M12 22l6-13"/></svg>,
        ring: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="8"/><circle cx="12" cy="12" r="3"/></svg>,
        chevronRight: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
        chevronLeft: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
        check: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
        refresh: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>,
        heart: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
        loader: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="spin"><path d="M21 12a9 9 0 1 1-6.219-8.56"/></svg>,
        sparkles: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
        shoppingBag: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z"/><path d="M3 6h18"/><path d="M16 10a4 4 0 0 1-8 0"/></svg>,
        play: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>,
        message: <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/></svg>
      };
      return icons[name] || null;
    };

    // Mock data for demo mode
    const mockSettings = [
      { id: '1', sku: 'HH-101', name: 'Hidden Halo Oval', style: 'Hidden Halo', prices: { '4W2B': { label: '14K White Gold', color: 'White', price: 1850 }, '4Y2B': { label: '14K Yellow Gold', color: 'Yellow', price: 1850 }, '4K2B': { label: '14K Rose Gold', color: 'Pink', price: 1850 }, 'PP2B': { label: 'Platinum', color: 'White', price: 2450 } }, centerShapes: ['OVAL', 'ROUND', 'CUSHION'], sideDiamondCount: 32, shippingDays: 14, images: ['https://www.overnightmountings.com/media/catalog/product/8/3/83626_4.jpg'] },
      { id: '2', sku: 'SOL-202', name: 'Classic Solitaire', style: 'Solitaire', prices: { '4W2B': { label: '14K White Gold', color: 'White', price: 980 }, '4Y2B': { label: '14K Yellow Gold', color: 'Yellow', price: 980 }, '4K2B': { label: '14K Rose Gold', color: 'Pink', price: 980 }, 'PP2B': { label: 'Platinum', color: 'White', price: 1580 } }, centerShapes: ['ROUND', 'OVAL', 'PRINCESS', 'CUSHION', 'EMERALD', 'PEAR', 'MARQUISE', 'RADIANT', 'ASSCHER', 'HEART'], sideDiamondCount: 0, shippingDays: 10, images: ['https://www.overnightmountings.com/media/catalog/product/8/1/81208_5.jpg'] },
      { id: '3', sku: 'HAL-303', name: 'Round Halo Pavé', style: 'Halo', prices: { '4W2B': { label: '14K White Gold', color: 'White', price: 2150 }, '4Y2B': { label: '14K Yellow Gold', color: 'Yellow', price: 2150 }, '4K2B': { label: '14K Rose Gold', color: 'Pink', price: 2150 }, 'PP2B': { label: 'Platinum', color: 'White', price: 2750 } }, centerShapes: ['ROUND'], sideDiamondCount: 48, shippingDays: 14, images: ['https://www.overnightmountings.com/media/catalog/product/8/4/84817_4.jpg'] },
      { id: '4', sku: 'THR-404', name: 'Three Stone Classic', style: 'Three Stone', prices: { '4W2B': { label: '14K White Gold', color: 'White', price: 2450 }, '4Y2B': { label: '14K Yellow Gold', color: 'Yellow', price: 2450 }, '4K2B': { label: '14K Rose Gold', color: 'Pink', price: 2450 }, 'PP2B': { label: 'Platinum', color: 'White', price: 3050 } }, centerShapes: ['OVAL', 'ROUND', 'EMERALD'], sideDiamondCount: 2, shippingDays: 14, images: ['https://www.overnightmountings.com/media/catalog/product/8/2/82943_4.jpg'] },
      { id: '5', sku: 'VIN-505', name: 'Vintage Milgrain', style: 'Vintage', prices: { '4W2B': { label: '14K White Gold', color: 'White', price: 1950 }, '4Y2B': { label: '14K Yellow Gold', color: 'Yellow', price: 1950 }, '4K2B': { label: '14K Rose Gold', color: 'Pink', price: 1950 }, 'PP2B': { label: 'Platinum', color: 'White', price: 2550 } }, centerShapes: ['ROUND', 'OVAL', 'CUSHION'], sideDiamondCount: 24, shippingDays: 14, images: ['https://www.overnightmountings.com/media/catalog/product/8/5/85004_4.jpg'] },
      { id: '6', sku: 'PAV-606', name: 'Cathedral Pavé', style: 'Pavé', prices: { '4W2B': { label: '14K White Gold', color: 'White', price: 1750 }, '4Y2B': { label: '14K Yellow Gold', color: 'Yellow', price: 1750 }, '4K2B': { label: '14K Rose Gold', color: 'Pink', price: 1750 }, 'PP2B': { label: 'Platinum', color: 'White', price: 2350 } }, centerShapes: ['ROUND', 'OVAL', 'PRINCESS', 'CUSHION'], sideDiamondCount: 36, shippingDays: 12, images: ['https://www.overnightmountings.com/media/catalog/product/8/3/83844_4.jpg'] },
    ];

    const shapes = [
      { id: 'ROUND', name: 'Round', icon: '○' },
      { id: 'OVAL', name: 'Oval', icon: '⬭' },
      { id: 'PRINCESS', name: 'Princess', icon: '◇' },
      { id: 'CUSHION', name: 'Cushion', icon: '▢' },
      { id: 'EMERALD', name: 'Emerald', icon: '▭' },
      { id: 'PEAR', name: 'Pear', icon: '◊' },
      { id: 'MARQUISE', name: 'Marquise', icon: '◇' },
      { id: 'RADIANT', name: 'Radiant', icon: '▣' },
      { id: 'ASSCHER', name: 'Asscher', icon: '□' },
      { id: 'HEART', name: 'Heart', icon: '♡' }
    ];

    const styles = ['Solitaire', 'Halo', 'Hidden Halo', 'Three Stone', 'Pavé', 'Vintage'];
    const ringSizes = ['4', '4.5', '5', '5.5', '6', '6.5', '7', '7.5', '8', '8.5', '9', '9.5', '10', '10.5', '11', '11.5', '12'];

    const metalColors = { 'White': '#E8E8E8', 'Yellow': '#FFD700', 'Pink': '#B76E79' };

    function RingBuilder() {
      const [currentStep, setCurrentStep] = useState(0);
      const [entryPoint, setEntryPoint] = useState(null);
      const [selectedSetting, setSelectedSetting] = useState(null);
      const [selectedMetal, setSelectedMetal] = useState(null);
      const [selectedShape, setSelectedShape] = useState(null);
      const [selectedSize, setSelectedSize] = useState(null);
      const [uploadedImage, setUploadedImage] = useState(null);
      const [analyzedTraits, setAnalyzedTraits] = useState(null);
      const [isAnalyzing, setIsAnalyzing] = useState(false);
      const [settings, setSettings] = useState([]);
      const [loading, setLoading] = useState(false);
      const [filters, setFilters] = useState({ style: null, centerShape: null });

      useEffect(() => {
        if (currentStep === 1 && entryPoint) {
          fetchSettings();
        }
      }, [currentStep, entryPoint, filters]);

      const fetchSettings = async () => {
        setLoading(true);
        
        if (!CONFIG.USE_LIVE_API) {
          // Demo mode - use mock data
          setTimeout(() => {
            let filtered = [...mockSettings];
            if (filters.style) {
              filtered = filtered.filter(s => s.style === filters.style);
            }
            if (filters.centerShape) {
              filtered = filtered.filter(s => s.centerShapes.includes(filters.centerShape));
            }
            setSettings(filtered);
            setLoading(false);
          }, 500);
          return;
        }

        try {
          const params = new URLSearchParams({ page: 1, limit: 20 });
          if (filters.style) params.append('style', filters.style);
          if (filters.centerShape) params.append('centerShape', filters.centerShape);
          
          const res = await fetch(`${CONFIG.API_BASE_URL}/settings?${params}`);
          const data = await res.json();
          
          if (data.success) {
            setSettings(data.data.items);
          }
        } catch (err) {
          console.error('API Error:', err);
          setSettings(mockSettings); // Fallback to mock
        } finally {
          setLoading(false);
        }
      };

      const handleImageUpload = useCallback((e) => {
        const file = e.target.files?.[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            setUploadedImage(event.target.result);
            setIsAnalyzing(true);
            setTimeout(() => {
              setAnalyzedTraits({
                style: 'Hidden Halo',
                metalColor: 'Yellow',
                shape: 'OVAL',
                estimatedCarat: '1.5-2.0',
                confidence: 0.89
              });
              setIsAnalyzing(false);
            }, 2500);
          };
          reader.readAsDataURL(file);
        }
      }, []);

      const applyAnalyzedTraits = () => {
        if (analyzedTraits) {
          setFilters({ style: analyzedTraits.style, centerShape: analyzedTraits.shape });
          setEntryPoint('band');
          setCurrentStep(1);
        }
      };

      const selectSetting = (setting) => {
        setSelectedSetting(setting);
        const priceKeys = Object.keys(setting.prices);
        if (priceKeys.length > 0) setSelectedMetal(priceKeys[0]);
      };

      const resetBuilder = () => {
        setCurrentStep(0);
        setEntryPoint(null);
        setSelectedSetting(null);
        setSelectedMetal(null);
        setSelectedShape(null);
        setSelectedSize(null);
        setUploadedImage(null);
        setAnalyzedTraits(null);
        setFilters({ style: null, centerShape: null });
      };

      const canProceed = () => {
        if (currentStep === 1) return selectedSetting && selectedMetal;
        if (currentStep === 2) return selectedShape;
        if (currentStep === 3) return selectedSize;
        return false;
      };

      const addToCart = async () => {
        const config = {
          setting_sku: selectedSetting.sku,
          setting_name: selectedSetting.name,
          metal: selectedSetting.prices[selectedMetal]?.label,
          center_shape: selectedShape,
          ring_size: selectedSize
        };

        try {
          const response = await fetch(`https://${CONFIG.SHOPIFY_DOMAIN}/cart/add.js`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              id: CONFIG.CUSTOM_RING_VARIANT_ID,
              quantity: 1,
              properties: config
            })
          });
          
          if (response.ok) {
            window.location.href = `https://${CONFIG.SHOPIFY_DOMAIN}/cart`;
          }
        } catch (err) {
          // Demo mode - show config
          alert(`Ring Configuration Saved!\n\n${Object.entries(config).map(([k,v]) => `${k}: ${v}`).join('\n')}\n\nIn production, this adds to your Shopify cart.`);
        }
      };

      // Entry Selection
      const renderEntrySelection = () => (
        <div className="entry-selection">
          <div className="entry-header">
            <h1>Design Your Ring</h1>
            <p>Create your perfect engagement ring in three simple steps</p>
          </div>
          
          <div className="entry-cards">
            <button className="entry-card" onClick={() => { setEntryPoint('band'); setCurrentStep(1); }}>
              <div className="entry-icon"><Icon name="ring" size={48} /></div>
              <h3>Start with Setting</h3>
              <p>Browse our collection of ring settings and find the perfect foundation</p>
              <span className="entry-cta">Browse Settings <Icon name="chevronRight" size={16} /></span>
            </button>
            
            <button className="entry-card" onClick={() => { setEntryPoint('shape'); setCurrentStep(1); }}>
              <div className="entry-icon"><Icon name="diamond" size={48} /></div>
              <h3>Start with Shape</h3>
              <p>Choose your preferred diamond shape first, then find compatible settings</p>
              <span className="entry-cta">Choose Shape <Icon name="chevronRight" size={16} /></span>
            </button>
            
            <label className="entry-card">
              <input type="file" accept="image/*" onChange={handleImageUpload} hidden />
              <div className="entry-icon"><Icon name="upload" size={48} /></div>
              <h3>Upload Inspiration</h3>
              <p>Have a ring you love? Upload an image and we'll find similar styles</p>
              <span className="entry-cta">Upload Image <Icon name="chevronRight" size={16} /></span>
            </label>
          </div>
        </div>
      );

      // Image Analysis
      const renderImageAnalysis = () => (
        <div className="image-analysis">
          <button className="back-button" onClick={resetBuilder}>
            <Icon name="chevronLeft" size={20} /> Back
          </button>
          
          <div className="analysis-content">
            <div className="uploaded-preview">
              <img src={uploadedImage} alt="Uploaded ring" />
            </div>
            
            {isAnalyzing ? (
              <div className="analyzing">
                <div className="spin"><Icon name="sparkles" size={32} /></div>
                <h3>Analyzing your inspiration...</h3>
                <p>Our AI is identifying the ring characteristics</p>
              </div>
            ) : analyzedTraits && (
              <div className="traits-panel">
                <h3>We identified these characteristics</h3>
                <div className="traits-list">
                  <div className="trait"><span className="trait-label">Style</span><span className="trait-value">{analyzedTraits.style}</span></div>
                  <div className="trait"><span className="trait-label">Metal</span><span className="trait-value">{analyzedTraits.metalColor} Gold</span></div>
                  <div className="trait"><span className="trait-label">Shape</span><span className="trait-value">{analyzedTraits.shape}</span></div>
                  <div className="trait"><span className="trait-label">Est. Carat</span><span className="trait-value">{analyzedTraits.estimatedCarat}</span></div>
                </div>
                <div className="confidence">Confidence: {Math.round(analyzedTraits.confidence * 100)}%</div>
                <div className="analysis-actions">
                  <button className="primary-btn" onClick={applyAnalyzedTraits}>Find Similar Rings <Icon name="chevronRight" size={18} /></button>
                  <button className="secondary-btn" onClick={resetBuilder}>Start Over</button>
                </div>
              </div>
            )}
          </div>
        </div>
      );

      // Progress Bar
      const renderProgressBar = () => (
        <div className="progress-bar">
          <button className="reset-btn" onClick={resetBuilder}><Icon name="refresh" size={16} /> Start Over</button>
          
          <div className="steps">
            {[
              { num: 1, label: 'Setting', value: selectedSetting?.name },
              { num: 2, label: 'Shape', value: selectedShape },
              { num: 3, label: 'Size', value: selectedSize ? `Size ${selectedSize}` : null }
            ].map((step, idx) => (
              <React.Fragment key={step.num}>
                <div className={`step ${currentStep === step.num ? 'active' : ''} ${currentStep > step.num ? 'complete' : ''}`}>
                  <div className="step-number">{currentStep > step.num ? <Icon name="check" size={16} /> : step.num}</div>
                  <div className="step-info">
                    <span className="step-label">{step.label}</span>
                    {step.value && <span className="step-selection">{step.value}</span>}
                  </div>
                </div>
                {idx < 2 && <div className="step-connector" />}
              </React.Fragment>
            ))}
          </div>
        </div>
      );

      // Setting Selection
      const renderSettingSelection = () => (
        <div className="selection-panel">
          <div className="panel-header">
            <h2>Choose Your Setting</h2>
            <p>Select the perfect ring setting for your diamond</p>
          </div>
          
          <div className="filters">
            <div className="filter-group">
              <label>Style</label>
              <div className="filter-options">
                <button className={!filters.style ? 'active' : ''} onClick={() => setFilters({...filters, style: null})}>All</button>
                {styles.map(style => (
                  <button key={style} className={filters.style === style ? 'active' : ''} onClick={() => setFilters({...filters, style})}>{style}</button>
                ))}
              </div>
            </div>
            
            <div className="filter-group">
              <label>Center Shape</label>
              <div className="filter-options shapes">
                <button className={!filters.centerShape ? 'active' : ''} onClick={() => setFilters({...filters, centerShape: null})}>All</button>
                {shapes.slice(0, 6).map(shape => (
                  <button key={shape.id} className={filters.centerShape === shape.id ? 'active' : ''} onClick={() => setFilters({...filters, centerShape: shape.id})}>
                    <span className="shape-icon">{shape.icon}</span>
                    <span className="shape-name">{shape.name}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>
          
          <div className="results-count">{loading ? 'Loading...' : `${settings.length} Settings`}</div>
          
          <div className="items-grid">
            {settings.map(setting => (
              <button key={setting.id} className={`item-card ${selectedSetting?.id === setting.id ? 'selected' : ''}`} onClick={() => selectSetting(setting)}>
                <div className="item-image">
                  {setting.images?.[0] ? <img src={setting.images[0]} alt={setting.name} /> : <div className="placeholder"><Icon name="diamond" size={48} /></div>}
                </div>
                <div className="item-details">
                  <h4>{setting.name}</h4>
                  <p className="item-sku">Style: {setting.sku}</p>
                  <p className="item-meta">{setting.style} • {setting.shippingDays} days</p>
                </div>
                {selectedSetting?.id === setting.id && <div className="selected-badge"><Icon name="check" size={14} /> Selected</div>}
              </button>
            ))}
          </div>
          
          {selectedSetting && (
            <div className="detail-panel">
              <div className="detail-image">
                <img src={selectedSetting.images?.[0]} alt={selectedSetting.name} />
              </div>
              <div className="detail-info">
                <h3>{selectedSetting.name}</h3>
                <p>Style: {selectedSetting.sku}</p>
                
                <div className="metal-selector">
                  <label>Select Metal</label>
                  <div className="metal-options">
                    {Object.entries(selectedSetting.prices).map(([code, info]) => (
                      <button key={code} className={`metal-option ${selectedMetal === code ? 'selected' : ''}`} onClick={() => setSelectedMetal(code)}>
                        <span className="metal-swatch" style={{ background: metalColors[info.color] }} />
                        <span>{info.label}</span>
                      </button>
                    ))}
                  </div>
                </div>
                
                <div className="detail-specs">
                  <div className="spec"><span className="spec-label">Style</span><span>{selectedSetting.style}</span></div>
                  <div className="spec"><span className="spec-label">Side Diamonds</span><span>{selectedSetting.sideDiamondCount || 'None'}</span></div>
                  <div className="spec"><span className="spec-label">Ships In</span><span>{selectedSetting.shippingDays} days</span></div>
                </div>
              </div>
            </div>
          )}
        </div>
      );

      // Shape Selection
      const renderShapeSelection = () => (
        <div className="selection-panel shape-panel">
          <div className="panel-header">
            <h2>Select Center Stone Shape</h2>
            <p>Choose the shape for your center diamond</p>
          </div>
          
          {selectedSetting && (
            <div className="compatibility-note">
              <Icon name="check" size={16} /> Showing shapes compatible with {selectedSetting.name}
            </div>
          )}
          
          <div className="shapes-grid">
            {shapes.filter(shape => !selectedSetting || selectedSetting.centerShapes.includes(shape.id)).map(shape => (
              <button key={shape.id} className={`shape-card ${selectedShape === shape.id ? 'selected' : ''}`} onClick={() => setSelectedShape(shape.id)}>
                <span className="shape-icon-large">{shape.icon}</span>
                <span>{shape.name}</span>
                {selectedShape === shape.id && <div className="selected-check"><Icon name="check" size={16} /></div>}
              </button>
            ))}
          </div>
          
          <div className="stone-note">
            <Icon name="message" size={20} />
            <div>
              <strong>Need help finding the perfect stone?</strong>
              <p>Our team will help you select a beautiful center diamond that fits your budget.</p>
            </div>
          </div>
        </div>
      );

      // Size Selection
      const renderSizeSelection = () => (
        <div className="selection-panel size-panel">
          <div className="panel-header">
            <h2>Select Ring Size</h2>
            <p>Choose your ring size to complete your design</p>
          </div>
          
          <div className="ring-preview">
            <div className="preview-image">
              {selectedSetting?.images?.[0] && <img src={selectedSetting.images[0]} alt="" />}
            </div>
            <div className="preview-details">
              <h3>Your Custom Ring</h3>
              <p>{selectedSetting?.name}</p>
              <p>{selectedSetting?.prices[selectedMetal]?.label} • {selectedShape}</p>
            </div>
          </div>
          
          <div className="size-selector">
            <label>Ring Size</label>
            <div className="size-options">
              {ringSizes.map(size => (
                <button key={size} className={`size-btn ${selectedSize === size ? 'selected' : ''}`} onClick={() => setSelectedSize(size)}>{size}</button>
              ))}
            </div>
            <a href="#" className="size-guide">Need help finding your size?</a>
          </div>
          
          <div className="order-summary">
            <h3>Ring Configuration</h3>
            <div className="summary-row"><span>Setting</span><span>{selectedSetting?.name}</span></div>
            <div className="summary-row"><span>Metal</span><span>{selectedSetting?.prices[selectedMetal]?.label}</span></div>
            <div className="summary-row"><span>Center Shape</span><span>{selectedShape}</span></div>
            <div className="summary-row"><span>Size</span><span>{selectedSize || '—'}</span></div>
            <div className="summary-note">A jewelry specialist will contact you to finalize your center stone and provide a quote.</div>
          </div>
        </div>
      );

      return (
        <div className="ring-builder">
          {currentStep === 0 && !uploadedImage && renderEntrySelection()}
          {uploadedImage && !entryPoint && renderImageAnalysis()}
          
          {currentStep > 0 && (
            <>
              {renderProgressBar()}
              {currentStep === 1 && renderSettingSelection()}
              {currentStep === 2 && renderShapeSelection()}
              {currentStep === 3 && renderSizeSelection()}
              
              <div className="navigation">
                <button className="nav-btn back" onClick={() => currentStep === 1 ? resetBuilder() : setCurrentStep(currentStep - 1)}>
                  <Icon name="chevronLeft" size={18} /> Back
                </button>
                
                {currentStep < 3 ? (
                  <button className="nav-btn next" disabled={!canProceed()} onClick={() => setCurrentStep(currentStep + 1)}>
                    Continue <Icon name="chevronRight" size={18} />
                  </button>
                ) : (
                  <button className="nav-btn checkout" disabled={!canProceed()} onClick={addToCart}>
                    <Icon name="shoppingBag" size={18} /> Request Quote
                  </button>
                )}
              </div>
            </>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('ring-builder-root')).render(<RingBuilder />);
  </script>
  
  <style>
    .ring-builder {
      --gold: #B8860B;
      --gold-light: #D4AF37;
      --cream: #FAF7F2;
      --charcoal: #2C2C2C;
      --gray: #6B6B6B;
      --light-gray: #E8E5E0;
      --teal: #1B4D4D;
      --teal-light: #2A6B6B;
      font-family: 'Outfit', sans-serif;
      background: var(--cream);
      min-height: 100vh;
      color: var(--charcoal);
      padding-bottom: 100px;
    }
    h1, h2, h3, h4 { font-family: 'Cormorant Garamond', serif; font-weight: 400; }
    
    /* Entry */
    .entry-selection { padding: 60px 40px; max-width: 1100px; margin: 0 auto; }
    .entry-header { text-align: center; margin-bottom: 50px; }
    .entry-header h1 { font-size: 3rem; margin-bottom: 12px; }
    .entry-header p { color: var(--gray); font-size: 1.1rem; }
    .entry-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 28px; }
    .entry-card { background: white; border: 1px solid var(--light-gray); border-radius: 4px; padding: 40px 28px; text-align: center; cursor: pointer; transition: all 0.3s; display: flex; flex-direction: column; align-items: center; font-family: inherit; }
    .entry-card:hover { border-color: var(--gold); box-shadow: 0 16px 48px rgba(0,0,0,0.08); transform: translateY(-3px); }
    .entry-icon { width: 90px; height: 90px; border-radius: 50%; background: linear-gradient(135deg, var(--cream), white); display: flex; align-items: center; justify-content: center; margin-bottom: 24px; color: var(--gold); }
    .entry-card h3 { font-size: 1.4rem; margin-bottom: 10px; }
    .entry-card p { font-size: 0.9rem; color: var(--gray); line-height: 1.5; margin-bottom: 20px; }
    .entry-cta { color: var(--teal); font-weight: 500; font-size: 0.85rem; display: flex; align-items: center; gap: 4px; margin-top: auto; }
    
    /* Progress */
    .progress-bar { background: white; border-bottom: 1px solid var(--light-gray); padding: 16px 40px; display: flex; align-items: center; gap: 32px; position: sticky; top: 0; z-index: 100; }
    .reset-btn { display: flex; align-items: center; gap: 6px; background: none; border: 1px solid var(--light-gray); padding: 8px 14px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; color: var(--gray); font-family: inherit; }
    .reset-btn:hover { border-color: var(--charcoal); color: var(--charcoal); }
    .steps { display: flex; align-items: center; gap: 12px; flex: 1; justify-content: center; }
    .step { display: flex; align-items: center; gap: 10px; padding: 10px 16px; border-radius: 4px; }
    .step.active { background: var(--cream); }
    .step-number { width: 28px; height: 28px; border-radius: 50%; background: var(--light-gray); display: flex; align-items: center; justify-content: center; font-size: 0.8rem; font-weight: 500; color: var(--gray); }
    .step.active .step-number { background: var(--teal); color: white; }
    .step.complete .step-number { background: var(--gold); color: white; }
    .step-info { display: flex; flex-direction: column; gap: 1px; }
    .step-label { font-size: 0.8rem; font-weight: 500; }
    .step-selection { font-size: 0.7rem; color: var(--gray); max-width: 120px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .step-connector { width: 32px; height: 1px; background: var(--light-gray); }
    
    /* Selection Panel */
    .selection-panel { max-width: 1300px; margin: 0 auto; padding: 32px 40px; }
    .panel-header { text-align: center; margin-bottom: 32px; }
    .panel-header h2 { font-size: 2.2rem; margin-bottom: 6px; }
    .panel-header p { color: var(--gray); }
    
    /* Filters */
    .filters { background: white; padding: 20px; border-radius: 4px; margin-bottom: 20px; display: flex; flex-direction: column; gap: 16px; }
    .filter-group label { font-size: 0.8rem; font-weight: 500; color: var(--gray); display: block; margin-bottom: 10px; }
    .filter-options { display: flex; flex-wrap: wrap; gap: 6px; }
    .filter-options button { background: var(--cream); border: 1px solid transparent; padding: 7px 14px; border-radius: 4px; font-size: 0.8rem; cursor: pointer; font-family: inherit; transition: all 0.2s; }
    .filter-options button:hover { border-color: var(--gold); }
    .filter-options button.active { background: var(--teal); color: white; }
    .filter-options.shapes button { display: flex; flex-direction: column; align-items: center; padding: 10px 14px; gap: 3px; }
    .shape-icon { font-size: 1.2rem; }
    .shape-name { font-size: 0.7rem; }
    .results-count { font-size: 0.85rem; color: var(--gray); margin-bottom: 16px; }
    
    /* Items Grid */
    .items-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 24px; }
    .item-card { background: white; border: 2px solid transparent; border-radius: 4px; overflow: hidden; cursor: pointer; transition: all 0.3s; text-align: left; font-family: inherit; position: relative; }
    .item-card:hover { box-shadow: 0 10px 32px rgba(0,0,0,0.1); transform: translateY(-2px); }
    .item-card.selected { border-color: var(--teal); }
    .item-image { height: 200px; background: #f5f5f5; overflow: hidden; }
    .item-image img { width: 100%; height: 100%; object-fit: cover; }
    .item-image .placeholder { width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: var(--light-gray); }
    .item-details { padding: 14px; }
    .item-details h4 { font-size: 0.95rem; margin-bottom: 3px; font-family: 'Cormorant Garamond', serif; }
    .item-sku { font-size: 0.75rem; color: var(--gray); margin-bottom: 2px; }
    .item-meta { font-size: 0.75rem; color: var(--gray); }
    .selected-badge { position: absolute; bottom: 0; left: 0; right: 0; background: var(--teal); color: white; padding: 6px; font-size: 0.8rem; display: flex; align-items: center; justify-content: center; gap: 5px; }
    
    /* Detail Panel */
    .detail-panel { position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%); width: calc(100% - 80px); max-width: 900px; background: white; border-radius: 8px; box-shadow: 0 -8px 48px rgba(0,0,0,0.12); display: grid; grid-template-columns: 260px 1fr; overflow: hidden; z-index: 50; }
    .detail-image { background: #f8f8f8; padding: 16px; }
    .detail-image img { width: 100%; aspect-ratio: 1; object-fit: cover; border-radius: 4px; }
    .detail-info { padding: 20px; }
    .detail-info h3 { font-size: 1.4rem; margin-bottom: 4px; }
    .detail-info > p { font-size: 0.8rem; color: var(--gray); margin-bottom: 16px; }
    .metal-selector { margin-bottom: 16px; }
    .metal-selector label { display: block; font-size: 0.8rem; font-weight: 500; margin-bottom: 8px; }
    .metal-options { display: flex; flex-wrap: wrap; gap: 6px; }
    .metal-option { display: flex; align-items: center; gap: 6px; padding: 8px 12px; border: 1px solid var(--light-gray); border-radius: 4px; background: white; cursor: pointer; font-family: inherit; font-size: 0.8rem; }
    .metal-option:hover { border-color: var(--gold); }
    .metal-option.selected { border-color: var(--teal); background: var(--teal); color: white; }
    .metal-swatch { width: 14px; height: 14px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.1); }
    .detail-specs { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .spec { background: var(--cream); padding: 10px; border-radius: 4px; }
    .spec-label { font-size: 0.7rem; color: var(--gray); display: block; margin-bottom: 2px; }
    .spec span:last-child { font-size: 0.85rem; }
    
    /* Shape Selection */
    .shape-panel { max-width: 800px; }
    .compatibility-note { background: #e8f5e9; color: #2e7d32; padding: 10px 14px; border-radius: 4px; display: flex; align-items: center; gap: 8px; margin-bottom: 28px; font-size: 0.85rem; }
    .shapes-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 14px; margin-bottom: 32px; }
    .shape-card { background: white; border: 2px solid var(--light-gray); border-radius: 6px; padding: 28px 14px; text-align: center; cursor: pointer; transition: all 0.2s; font-family: inherit; position: relative; }
    .shape-card:hover { border-color: var(--gold); }
    .shape-card.selected { border-color: var(--teal); background: var(--teal); color: white; }
    .shape-icon-large { font-size: 2.5rem; display: block; margin-bottom: 10px; }
    .selected-check { position: absolute; top: 6px; right: 6px; width: 22px; height: 22px; background: var(--gold); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; }
    .stone-note { background: white; padding: 20px; border-radius: 6px; display: flex; gap: 14px; align-items: flex-start; }
    .stone-note svg { color: var(--teal); flex-shrink: 0; margin-top: 2px; }
    .stone-note strong { display: block; margin-bottom: 4px; font-size: 0.95rem; }
    .stone-note p { font-size: 0.85rem; color: var(--gray); margin: 0; }
    
    /* Size Selection */
    .size-panel { max-width: 650px; }
    .ring-preview { background: white; padding: 28px; border-radius: 6px; display: flex; align-items: center; gap: 20px; margin-bottom: 24px; }
    .preview-image { width: 100px; height: 100px; border-radius: 6px; overflow: hidden; background: #f5f5f5; flex-shrink: 0; }
    .preview-image img { width: 100%; height: 100%; object-fit: cover; }
    .preview-details h3 { font-size: 1.4rem; margin-bottom: 6px; }
    .preview-details p { color: var(--gray); font-size: 0.9rem; margin: 0; }
    .size-selector { background: white; padding: 22px; border-radius: 6px; margin-bottom: 20px; }
    .size-selector > label { display: block; font-weight: 500; margin-bottom: 14px; }
    .size-options { display: flex; flex-wrap: wrap; gap: 6px; margin-bottom: 14px; }
    .size-btn { width: 44px; height: 44px; border: 1px solid var(--light-gray); border-radius: 4px; background: white; cursor: pointer; font-family: inherit; font-size: 0.85rem; }
    .size-btn:hover { border-color: var(--gold); }
    .size-btn.selected { background: var(--teal); color: white; border-color: var(--teal); }
    .size-guide { color: var(--teal); font-size: 0.85rem; }
    .order-summary { background: white; padding: 22px; border-radius: 6px; }
    .order-summary h3 { font-size: 1.1rem; margin-bottom: 14px; padding-bottom: 10px; border-bottom: 1px solid var(--light-gray); }
    .summary-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.85rem; border-bottom: 1px solid var(--cream); }
    .summary-note { margin-top: 14px; padding: 14px; background: var(--cream); border-radius: 4px; font-size: 0.8rem; color: var(--gray); line-height: 1.4; }
    
    /* Navigation */
    .navigation { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid var(--light-gray); padding: 16px 40px; display: flex; justify-content: space-between; align-items: center; z-index: 100; }
    .nav-btn { display: flex; align-items: center; gap: 6px; padding: 12px 24px; border-radius: 4px; font-family: inherit; font-size: 0.9rem; cursor: pointer; }
    .nav-btn.back { background: white; border: 1px solid var(--light-gray); color: var(--charcoal); }
    .nav-btn.back:hover { border-color: var(--charcoal); }
    .nav-btn.next { background: var(--teal); border: none; color: white; }
    .nav-btn.next:hover:not(:disabled) { background: var(--teal-light); }
    .nav-btn.next:disabled { opacity: 0.5; cursor: not-allowed; }
    .nav-btn.checkout { background: var(--gold); border: none; color: white; }
    .nav-btn.checkout:hover:not(:disabled) { background: var(--gold-light); }
    
    /* Image Analysis */
    .image-analysis { max-width: 850px; margin: 0 auto; padding: 32px 40px; }
    .back-button { display: flex; align-items: center; gap: 4px; background: none; border: none; color: var(--gray); cursor: pointer; font-family: inherit; font-size: 0.9rem; margin-bottom: 28px; }
    .analysis-content { display: grid; grid-template-columns: 1fr 1fr; gap: 32px; }
    .uploaded-preview { background: white; border-radius: 6px; overflow: hidden; box-shadow: 0 6px 28px rgba(0,0,0,0.1); }
    .uploaded-preview img { width: 100%; height: auto; display: block; }
    .analyzing { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 50px; text-align: center; color: var(--gold); }
    .analyzing h3 { font-size: 1.4rem; margin: 18px 0 6px; color: var(--charcoal); }
    .analyzing p { color: var(--gray); }
    .traits-panel { background: white; padding: 28px; border-radius: 6px; }
    .traits-panel h3 { font-size: 1.2rem; margin-bottom: 20px; }
    .traits-list { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 14px; }
    .trait { background: var(--cream); padding: 12px; border-radius: 4px; }
    .trait-label { font-size: 0.7rem; color: var(--gray); display: block; margin-bottom: 3px; }
    .trait-value { font-family: 'Cormorant Garamond', serif; font-size: 1.05rem; }
    .confidence { text-align: center; padding: 8px; background: #e8f5e9; border-radius: 4px; font-size: 0.8rem; color: #2e7d32; margin-bottom: 20px; }
    .analysis-actions { display: flex; flex-direction: column; gap: 10px; }
    .primary-btn { background: var(--teal); color: white; border: none; padding: 14px 20px; border-radius: 4px; font-family: inherit; font-size: 0.95rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 6px; }
    .primary-btn:hover { background: var(--teal-light); }
    .secondary-btn { background: white; color: var(--charcoal); border: 1px solid var(--light-gray); padding: 12px 20px; border-radius: 4px; font-family: inherit; font-size: 0.9rem; cursor: pointer; }
    
    /* Utilities */
    .spin { animation: spin 1s linear infinite; }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    
    /* Responsive */
    @media (max-width: 1100px) { .items-grid { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 900px) {
      .entry-cards { grid-template-columns: 1fr; max-width: 380px; margin: 0 auto; }
      .items-grid { grid-template-columns: repeat(2, 1fr); }
      .detail-panel { grid-template-columns: 1fr; max-height: 360px; overflow-y: auto; }
      .shapes-grid { grid-template-columns: repeat(3, 1fr); }
    }
    @media (max-width: 600px) {
      .selection-panel { padding: 20px; }
      .items-grid { grid-template-columns: 1fr; }
      .analysis-content { grid-template-columns: 1fr; }
      .progress-bar { padding: 12px 16px; gap: 12px; flex-wrap: wrap; }
      .steps { width: 100%; overflow-x: auto; justify-content: flex-start; }
      .navigation { padding: 12px 16px; }
      .shapes-grid { grid-template-columns: repeat(2, 1fr); }
    }
  </style>
</body>
</html>
